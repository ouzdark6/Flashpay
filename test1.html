<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Paiement PayTech</title>
  <script src="https://paytech.sn/cdn/paytech.min.js"></script>
</head>
<body>

  <button onclick="buy()">UPayer 5 000 XOF</button>

  <script>
    function buy() {
      const postData = {
        motif: 'Paiement Abonnement',
        telephone: '771234567',
        montant: '5000'
      };

      const paytech = new PayTech(postData);

      paytech.withOption({
        requestTokenUrl: 'https://script.google.com/macros/s/AKfycbyVJpHQQsDHUt8_wMGMgG5tCVdP2sSEO4BRxmg0HQ3NHD0hmZv1hAOPOkPRv2Ot9lWv/exec',
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Accept': 'application/json'
        },
        presentationMode: PayTech.OPEN_IN_POPUP,  <!-- Correction ici -->

        // Quand PayTech reçoit un token avec succès
        didGetToken: function (token, redirectUrl) {
          console.log('✅ Token reçu:', token);
        },

        // En cas d'erreur
        didReceiveError: function (error) {
          console.error('❌ Erreur PayTech:', error);
          alert('Erreur : ' + error.message || 'Erreur inconnue.');
        },

        // Si PayTech répond sans succès
        didReceiveNonSuccessResponse: function (response) {
          console.warn('⚠️ Réponse non success:', response);
          alert('Échec du paiement. Veuillez réessayer.');
        }
      }).send();
    }
  </script>

</body>
</html>
